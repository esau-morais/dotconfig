#!/usr/bin/env bash

SINK="@DEFAULT_SINK@"
STEP="${STEP:-5}"

get_volume() {
  pactl get-sink-volume "$SINK" \
    | grep -oP '\d+(?=%)' \
    | head -n1
}

is_muted() {
  pactl get-sink-mute "$SINK" | grep -q yes
}

case "$BLOCK_BUTTON" in
  1) pactl set-sink-mute "$SINK" toggle ;;          # left click
  3) pactl set-sink-mute "$SINK" toggle ;;          # right click
  4) pactl set-sink-volume "$SINK" +${STEP}% ;;     # scroll up
  5) pactl set-sink-volume "$SINK" -${STEP}% ;;     # scroll down
esac

if is_muted; then
  echo "${LABEL}MUTE"
  exit 0
fi

VOL=$(get_volume)
echo "${LABEL}${VOL}%"
